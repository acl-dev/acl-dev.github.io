

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="zsxxsz">
  <meta name="keywords" content="">
  
    <meta name="description" content="acl库使用FAQ 一、基础问题 1、acl 库是啥、主要包含哪些功能？ 2、acl 库支持哪些平台？ 3、acl 库主要包含几个库？ 4、acl 库有哪些外部依赖库？ 5、没有这些第三方库 acl 能否使用？ 6、acl 库的源码下载位置在哪儿？   二、编译&amp;使用问题 1、acl 库的编译过程？ 2、Linux 平台下库的编译顺序问题？ 3、Unix&#x2F;Linux 平台下编译">
<meta property="og:type" content="article">
<meta property="og:title" content="acl库使用FAQ">
<meta property="og:url" content="https://acl-dev.cn/2019/06/30/faq/index.html">
<meta property="og:site_name" content="Acl developer">
<meta property="og:description" content="acl库使用FAQ 一、基础问题 1、acl 库是啥、主要包含哪些功能？ 2、acl 库支持哪些平台？ 3、acl 库主要包含几个库？ 4、acl 库有哪些外部依赖库？ 5、没有这些第三方库 acl 能否使用？ 6、acl 库的源码下载位置在哪儿？   二、编译&amp;使用问题 1、acl 库的编译过程？ 2、Linux 平台下库的编译顺序问题？ 3、Unix&#x2F;Linux 平台下编译">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-06-30T05:08:24.000Z">
<meta property="article:modified_time" content="2023-01-29T02:52:30.180Z">
<meta property="article:author" content="zsxxsz">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>acl库使用FAQ - Acl developer</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"acl-dev.cn","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"zykZv6I4JOYMU6dwI0ehhPRG-gzGzoHsz","app_key":"5Dqdb47Rc6ylIri6ZJGMpt0B","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Acl develop!</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="acl库使用FAQ"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-06-30 13:08" pubdate>
          2019年6月30日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          88 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">acl库使用FAQ</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="acl库使用FAQ"><a href="#acl库使用FAQ" class="headerlink" title="acl库使用FAQ"></a>acl库使用FAQ</h2><ul>
<li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E9%97%AE%E9%A2%98">一、基础问题</a><ul>
<li><a href="#1acl-%E5%BA%93%E6%98%AF%E5%95%A5%E4%B8%BB%E8%A6%81%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD">1、acl 库是啥、主要包含哪些功能？</a></li>
<li><a href="#2acl-%E5%BA%93%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B9%B3%E5%8F%B0">2、acl 库支持哪些平台？</a></li>
<li><a href="#3acl-%E5%BA%93%E4%B8%BB%E8%A6%81%E5%8C%85%E5%90%AB%E5%87%A0%E4%B8%AA%E5%BA%93">3、acl 库主要包含几个库？</a></li>
<li><a href="#4acl-%E5%BA%93%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96%E5%BA%93">4、acl 库有哪些外部依赖库？</a></li>
<li><a href="#5%E6%B2%A1%E6%9C%89%E8%BF%99%E4%BA%9B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-acl-%E8%83%BD%E5%90%A6%E4%BD%BF%E7%94%A8">5、没有这些第三方库 acl 能否使用？</a></li>
<li><a href="#6acl-%E5%BA%93%E7%9A%84%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E4%BD%8D%E7%BD%AE%E5%9C%A8%E5%93%AA%E5%84%BF">6、acl 库的源码下载位置在哪儿？</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C%E7%BC%96%E8%AF%91%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98">二、编译&amp;使用问题</a><ul>
<li><a href="#1acl-%E5%BA%93%E7%9A%84%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B">1、acl 库的编译过程？</a></li>
<li><a href="#2linux-%E5%B9%B3%E5%8F%B0%E4%B8%8B%E5%BA%93%E7%9A%84%E7%BC%96%E8%AF%91%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98">2、Linux 平台下库的编译顺序问题？</a></li>
<li><a href="#3unixlinux-%E5%B9%B3%E5%8F%B0%E4%B8%8B%E7%BC%96%E8%AF%91-acl-%E5%BA%93%E6%97%B6%E7%9A%84%E7%BC%96%E8%AF%91%E9%80%89%E9%A1%B9%E6%98%AF%E4%BB%80%E4%B9%88">3、Unix&#x2F;Linux 平台下编译 acl 库时的编译选项是什么</a></li>
<li><a href="#4%E8%AF%B7%E7%BB%99%E5%87%BA-linux-%E5%B9%B3%E5%8F%B0%E4%B8%8B%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%80%E4%B8%AA-makefile">4、请给出 Linux 平台下最简单的一个 Makefile？</a></li>
<li><a href="#5linux-%E5%B9%B3%E5%8F%B0%E4%B8%8B%E6%89%BE%E4%B8%8D%E5%88%B0-libza-%E5%BA%93%E6%80%8E%E4%B9%88%E5%8A%9E">5、Linux 平台下找不到 libz.a 库怎么办？</a></li>
<li><a href="#6linux-%E5%B9%B3%E5%8F%B0%E4%B8%8B-acl-%E5%BA%93%E8%83%BD%E6%89%93%E5%8C%85%E6%88%90%E4%B8%80%E4%B8%AA%E5%BA%93%E5%90%97">6、Linux 平台下 acl 库能打包成一个库吗？</a></li>
<li><a href="#7linux-%E5%B9%B3%E5%8F%B0%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-ssl-%E5%8A%9F%E8%83%BD">7、Linux 平台下如何使用 ssl 功能？</a></li>
<li><a href="#8linux-%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-mysql-%E5%8A%9F%E8%83%BD">8、Linux 下如何使用 mysql 功能？</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89%E5%90%84%E4%B8%AA%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98">三、各个功能模块的使用问题</a><ul>
<li><a href="#%E4%B8%80%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1">（一）、网络通信</a></li>
<li><a href="#%E4%BA%8Chttp-%E6%A8%A1%E5%9D%97">（二）、HTTP 模块</a><ul>
<li><a href="#1-acl-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E6%96%AD%E7%82%B9%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD">1. acl HTTP 服务器是否支持断点下载功能？</a></li>
<li><a href="#2-acl-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD">2. acl HTTP 服务器是否支持文件上传功能？</a></li>
<li><a href="#3-acl-http-%E6%A8%A1%E5%9D%97%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F">3. acl HTTP 模块是否支持服务器&#x2F;客户端两种模式？</a></li>
<li><a href="#4-acl-http-%E6%A8%A1%E5%9D%97%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-websocket-%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE">4. acl HTTP 模块是否支持 websocket 通信协议？</a></li>
<li><a href="#5-acl-http-%E6%A8%A1%E5%9D%97%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-session">5. acl HTTP 模块是否支持 session？</a></li>
<li><a href="#6-HttpServletRequest-%E4%B8%BA%E4%BD%95%E8%AF%BB%E4%B8%8D%E5%88%B0-json-%E6%88%96-xml-%E6%95%B0%E6%8D%AE%E4%BD%93">6. HttpServletRequest 为何读不到 json 或 xml 数据体？</a></li>
<li><a href="#7-http_request-%E5%9B%A0%E6%9C%AA%E8%AE%BE-Host-%E5%AD%97%E6%AE%B5%E8%80%8C%E5%87%BA%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98">7. http_request 因未设 Host 字段而出错的问题</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89redis-%E6%A8%A1%E5%9D%97">（三）、Redis 模块</a><ul>
<li><a href="#1-acl-redis-%E5%BA%93%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E9%9B%86%E7%BE%A4%E5%8A%9F%E8%83%BD">1. acl redis 库是否支持集群功能？</a></li>
<li><a href="#2-acl-redis-%E5%BA%93%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%92%E5%88%86%E7%9A%84">2. acl redis 库是如何划分的？</a></li>
<li><a href="#3-acl-redis-%E5%BA%93%E4%B8%AD%E7%9A%84%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84">3. acl redis 库中的哪些类对象操作是线程安全的？</a></li>
<li><a href="#4-acl-redis-%E5%AE%A2%E6%88%B7%E5%BA%93%E5%BD%93%E8%BF%9E%E6%8E%A5%E6%96%AD%E5%BC%80%E6%97%B6%E6%98%AF%E5%90%A6%E4%BC%9A%E9%87%8D%E8%BF%9E">4. acl redis 客户库当连接断开时是否会重连？</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B%E5%8D%8F%E7%A8%8B%E6%A8%A1%E5%9D%97">（四）、协程模块</a><ul>
<li><a href="#1-%E5%8D%8F%E7%A8%8B%E9%87%8C%E9%9D%A2%E7%9A%84%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%98%AF%E4%BB%80%E4%B9%88%E5%8E%9F%E7%90%86%E7%9A%84">1. 协程里面的非阻塞是什么原理的？</a></li>
<li><a href="#2-acl-%E5%8D%8F%E7%A8%8B%E5%BA%93%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E5%A4%9A%E7%BA%BF%E7%A8%8B">2. acl 协程库是否支持多线程？</a></li>
<li><a href="#3-acl-%E5%8D%8F%E7%A8%8B%E5%BA%93%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E5%A4%9A%E6%A0%B8-cpu">3. acl 协程库如何支持多核 CPU？</a></li>
<li><a href="#4-acl-%E5%8D%8F%E7%A8%8B%E9%87%8C%E9%92%88%E5%AF%B9-mysql-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%93%E7%9A%84%E5%8D%8F%E7%A8%8B%E5%8C%96%E6%98%AF%E5%90%A6%E4%BF%AE%E6%94%B9%E4%BA%86-mysql-%E5%BA%93%E7%9A%84%E6%BA%90%E7%A0%81">4. acl 协程里针对 mysql 客户端库的协程化是否修改了 mysql 库的源码？</a></li>
<li><a href="#5-acl-%E5%8D%8F%E7%A8%8B%E5%BA%93%E6%94%AF%E6%8C%81%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%8A%9F%E8%83%BD%E5%90%97">5. acl 协程库支持域名解析功能吗？</a></li>
<li><a href="#6-acl-%E5%8D%8F%E7%A8%8B%E5%BA%93%E7%9A%84%E7%B3%BB%E7%BB%9F-errno-%E5%8F%B7%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86">6. acl 协程库的系统 errno 号如何处理？</a></li>
<li><a href="#7-%E5%A6%82%E6%9E%9C%E5%90%AF%E5%8A%A8%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%BF%87%E5%A4%9A%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%AF%B9%E4%BA%8E%E5%90%8E%E7%AB%AF%E4%BE%8B%E5%A6%82-mysql-%E4%B9%8B%E7%B1%BB%E6%9C%8D%E5%8A%A1%E9%80%A0%E6%88%90%E5%B9%B6%E5%8F%91%E5%8E%8B%E5%8A%9B%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D">7. 如果启动的协程过多，会不会对于后端例如 mysql 之类服务造成并发压力？如何避免？</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E5%9D%97">（五）、服务器模块</a><ul>
<li><a href="#1-%E6%9C%89%E5%87%A0%E7%A7%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E5%9D%87%E6%9C%89%E4%BD%95%E7%89%B9%E7%82%B9">1. 有几种服务器编程模型？均有何特点？</a></li>
<li><a href="#2-acl_master-%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B9%B3%E5%8F%B0">2. acl_master 的作用是什么？支持哪些平台？</a></li>
<li><a href="#3-%E6%B2%A1%E6%9C%89-acl_master-%E6%8E%A7%E5%88%B6%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%8D%95%E7%8B%AC%E8%BF%90%E8%A1%8C">3. 没有 acl_master 控制管理，服务子进程是否可以单独运行？</a></li>
<li><a href="#4-%E6%89%8B%E5%B7%A5%E6%A8%A1%E5%BC%8F%E4%B8%8B%E8%BF%90%E8%A1%8C%E6%97%B6%E9%81%87%E5%88%B0idle-timeout----exiting-idle%E6%80%8E%E4%B9%88%E5%8A%9E">4. 手工模式下运行时遇到“idle timeout – exiting, idle”怎么办？</a></li>
<li><a href="#5-acl_master-%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%A6%82%E4%BD%95%E9%A2%84%E5%90%AF%E5%8A%A8%E5%A4%9A%E4%B8%AA%E8%BF%9B%E7%A8%8B">5. acl_master 控制模式下，服务子进程如何预启动多个进程？</a></li>
<li><a href="#6-acl_master-%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8F%AA%E7%9B%91%E5%90%AC%E5%86%85%E7%BD%91%E5%9C%B0%E5%9D%80">6. acl_master 控制模式下，如何只监听内网地址？</a></li>
</ul>
</li>
<li><a href="#%E5%85%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9D%97">（六）、数据库模块</a><ul>
<li><a href="#1-acl-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%E5%BA%93">1. acl 数据库客户端支持哪些数据库？</a></li>
<li><a href="#2-acl-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9D%97%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">2. acl 数据库模块如何使用？</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83%E9%82%AE%E4%BB%B6mime%E6%A8%A1%E5%9D%97">（七）、邮件&amp;mime模块</a></li>
</ul>
</li>
</ul>
<h3 id="一、基础问题"><a href="#一、基础问题" class="headerlink" title="一、基础问题"></a>一、基础问题</h3><h3 id="1、acl-库是啥、主要包含哪些功能？"><a href="#1、acl-库是啥、主要包含哪些功能？" class="headerlink" title="1、acl 库是啥、主要包含哪些功能？"></a>1、acl 库是啥、主要包含哪些功能？</h3><p>acl 工程是一个跨平台（支持LINUX，WIN32，Solaris，MacOS，FreeBSD）的网络通信库及服务器编程框架，同时提供更多的实用功能库。通过该库，用户可以非常容易地编写支持多种模式(多线程、多进程、非阻塞、触发器、UDP方式、协程方式)的服务器程序，WEB 应用程序，数据库应用程序。此外，该库还提供了常见应用的客户端通信库（如：HTTP、SMTP、ICMP、redis、disque、memcache、beanstalk、handler socket），常见流式编解码库：XML&#x2F;JSON&#x2F;MIME&#x2F;BASE64&#x2F;UUCODE&#x2F;QPCODE&#x2F;RFC2047 等。</p>
<h3 id="2、acl-库支持哪些平台？"><a href="#2、acl-库支持哪些平台？" class="headerlink" title="2、acl 库支持哪些平台？"></a>2、acl 库支持哪些平台？</h3><p>目前主要支持 Linux&#x2F;Windows&#x2F;Macos&#x2F;Freebsd&#x2F;Solaris(x86)。</p>
<h3 id="3、acl-库主要包含几个库？"><a href="#3、acl-库主要包含几个库？" class="headerlink" title="3、acl 库主要包含几个库？"></a>3、acl 库主要包含几个库？</h3><p>主要包括：lib_acl（用 C 语言写的基础库）、lib_protocol（用 C 语言写的一些网络应用协议库）、lib_acl_cpp（用 C++ 语言编写，封装了 lib_acl&#x2F;lib_protocol 两个库，同时增加更多实用的功能库）、 lib_fiber（用 C 语言编写的支持高性能、高并发的网络协程库）、lib_rpc（用C++语言编写的封装了 google protobuf 网络库）。</p>
<h3 id="4、acl-库有哪些外部依赖库？"><a href="#4、acl-库有哪些外部依赖库？" class="headerlink" title="4、acl 库有哪些外部依赖库？"></a>4、acl 库有哪些外部依赖库？</h3><p>lib_acl&#x2F;lib_protocol&#x2F;lib_fiber 仅依赖系统基础库；lib_acl_cpp 库的 db 模块依赖于 mysql 客户端库、sqlite 库，stream 流模块依赖于 polarssl 库（该库源码附在 acl&#x2F;resource 目录下），另外，在 UNIX&#x2F;LINUX 平台下还需要压缩库 — libz 库（一般 LINUX 会自带该压缩库）；lib_rpc 依赖于 protobuf 库。</p>
<h3 id="5、没有这些第三方库-acl-能否使用？"><a href="#5、没有这些第三方库-acl-能否使用？" class="headerlink" title="5、没有这些第三方库 acl 能否使用？"></a>5、没有这些第三方库 acl 能否使用？</h3><p>可以。默认情况下，没有这些第三方库编译和使用 acl 库是没有问题的，只是不能使用 mysql&#x2F;sqlite&#x2F;ssl&#x2F;protobuf 功能。</p>
<h3 id="6、acl-库的源码下载位置在哪儿？"><a href="#6、acl-库的源码下载位置在哪儿？" class="headerlink" title="6、acl 库的源码下载位置在哪儿？"></a>6、acl 库的源码下载位置在哪儿？</h3><ul>
<li>github：<a target="_blank" rel="noopener" href="https://github.com/acl-dev/acl/">https://github.com/acl-dev/acl/</a></li>
<li>oschina: <a target="_blank" rel="noopener" href="https://git.oschina.net/acl-dev/acl/">https://git.oschina.net/acl-dev/acl/</a></li>
<li>sourceforge：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/acl/">https://sourceforge.net/projects/acl/</a></li>
</ul>
<h3 id="二、编译-amp-使用问题"><a href="#二、编译-amp-使用问题" class="headerlink" title="二、编译&amp;使用问题"></a>二、编译&amp;使用问题</h3><h3 id="1、acl-库的编译过程？"><a href="#1、acl-库的编译过程？" class="headerlink" title="1、acl 库的编译过程？"></a>1、acl 库的编译过程？</h3><p>acl 库的编译过程请参考：<a target="_blank" rel="noopener" href="http://zsxxsz.iteye.com/blog/1506554">acl 的编译与使用</a> 博客。</p>
<h3 id="2、Linux-平台下库的编译顺序问题？"><a href="#2、Linux-平台下库的编译顺序问题？" class="headerlink" title="2、Linux 平台下库的编译顺序问题？"></a>2、Linux 平台下库的编译顺序问题？</h3><p>lib_acl 库是 acl 库中的基础库，其它库均依赖于该库，库的依赖顺序为：lib_protocol 依赖于 lib_acl，lib_acl_cpp 依赖于 lib_acl 和 lib_protocol，lib_fiber 依赖于 lib_acl，lib_rpc 依赖于 lib_acl&#x2F;lib_protocol&#x2F;lib_acl_cpp。因此当应用在连接 acl 库时，需要注意连接的顺序为：-l_acl_cpp -l_protocol -l_acl。</p>
<h3 id="3、Unix-x2F-Linux-平台下编译-acl-库时的编译选项是什么？"><a href="#3、Unix-x2F-Linux-平台下编译-acl-库时的编译选项是什么？" class="headerlink" title="3、Unix&#x2F;Linux 平台下编译 acl 库时的编译选项是什么？"></a>3、Unix&#x2F;Linux 平台下编译 acl 库时的编译选项是什么？</h3><p>在 Unix&#x2F;Linux 平台下编译 acl 库时需要指明 gcc 的编译选项，acl 库自带的 Makefile 会自动识别操作系统而选择不同的编译选项，下面列出不同 Unix 平台的不同编译选项（当前版本已自动识别系统类型，无需添加如下编译选项）：</p>
<ul>
<li>Linux 平台：-DLINUX2</li>
<li>MacOS 平台：-DMACOSX</li>
<li>FreeBSD 平台：-DFREEBSD</li>
<li>Solaris(x86) 平台：-DSUNOS5</li>
</ul>
<h3 id="4、请给出-Linux-平台下最简单的一个-Makefile？"><a href="#4、请给出-Linux-平台下最简单的一个-Makefile？" class="headerlink" title="4、请给出 Linux 平台下最简单的一个 Makefile？"></a>4、请给出 Linux 平台下最简单的一个 Makefile？</h3><p>下面是使用 acl 库的最简单的编译选项（因为排版问题，当拷贝下面内容至 Makefile 时，需要注意将每行前空格手工转成 TAB 键）：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gradle">fiber: main.o<br>	g++ -o fiber main.o \<br>		-L.<span class="hljs-regexp">/lib_fiber/</span>lib -lfiber_cpp \<br>		-L.<span class="hljs-regexp">/lib_acl_cpp/</span>lib -l_acl_cpp \<br>		-L.<span class="hljs-regexp">/lib_protocol/</span>lib -l_protocol \<br>		-L.<span class="hljs-regexp">/lib_acl/</span>lib -l_acl \<br>		-L.<span class="hljs-regexp">/lib_fiber/</span>lib -lfiber \<br>		-lz -lpthread -ldl<br>main.o: main.cpp<br>	g++ -O3 -Wall -c main.cpp -DLINUX2 \<br>		-I.<span class="hljs-regexp">/lib_acl/i</span>nclude \<br>		-I.<span class="hljs-regexp">/lib_acl_cpp/i</span>nclude \<br>		-I.<span class="hljs-regexp">/lib_fiber/</span>cpp/<span class="hljs-keyword">include</span> \<br>		-I.<span class="hljs-regexp">/lib_fiber/</span>c/<span class="hljs-keyword">include</span><br></code></pre></td></tr></table></figure>
<h3 id="5、Linux-平台下找不到-libz-a-库怎么办？"><a href="#5、Linux-平台下找不到-libz-a-库怎么办？" class="headerlink" title="5、Linux 平台下找不到 libz.a 库怎么办？"></a>5、Linux 平台下找不到 libz.a 库怎么办？</h3><p>一般 Unix&#x2F;Linux 平台下系统会自带 libz.a 或 libz.so 压缩库，如果找不到该库，则可以在线安装或采用编译安装 zlib 库，针对 Centos 和 Ubuntu 可分别通过以下方式在线安装（均需切换至 root 身份）：</p>
<ul>
<li>Centos：yum install zlib-devel</li>
<li>Ubuntu：apt-get install zlib1g.dev</li>
</ul>
<h3 id="6、Linux-平台下-acl-库能打包成一个库吗？"><a href="#6、Linux-平台下-acl-库能打包成一个库吗？" class="headerlink" title="6、Linux 平台下 acl 库能打包成一个库吗？"></a>6、Linux 平台下 acl 库能打包成一个库吗？</h3><p>可以。在 acl 目录下运行：make build_one 则可以将 lib_acl&#x2F;lib_protocol&#x2F;lib_acl_cpp 打包成一个完整的库：lib_acl.a&#x2F;lib_acl.so，则应用最终使用时可以仅连接这一个库即可。</p>
<h3 id="7、Linux-平台下如何使用-ssl-功能？"><a href="#7、Linux-平台下如何使用-ssl-功能？" class="headerlink" title="7、Linux 平台下如何使用 ssl 功能？"></a>7、Linux 平台下如何使用 ssl 功能？</h3><p>目前 acl 中的 lib_acl_cpp C++ 库通过集成 polarssl 支持 ssl 功能，所支持的 polarssl 源码的下载位置：<a target="_blank" rel="noopener" href="https://github.com/acl-dev/third_party">https://github.com/acl-dev/third_party</a>, 老版本 acl 通过静态连接 libpolarssl.a 实现对 ssl 的支持，当前版本则是通过动态加载 libpolarssl.so 方式实现了对 ssl 的支持，此动态支持方式更加灵活方便，无须特殊编译条件，也更为通用。</p>
<h4 id="7-1、老版本-acl-对-ssl-的支持方式"><a href="#7-1、老版本-acl-对-ssl-的支持方式" class="headerlink" title="7.1、老版本 acl 对 ssl 的支持方式"></a>7.1、老版本 acl 对 ssl 的支持方式</h4><p>如果使用上面统一的 acl 库，则可以在 acl 根目录下编译时运行：make build_one polarssl&#x3D;on；如果使用三个库：lib_acl.a，lib_protocol.a，lib_acl_cpp.a，则在编译前需要先指定环境变量：export ENV_FLAGS&#x3D;HAS_POLARSSL，然后分别编译这三个库；解压 polarssl-1.2.19-gpl.tgz，然后进入 polarssl-1.2.19 目录运行：make 编译后在 polarssl-1.2.19&#x2F;library 目录得到 libpolarssl.a 库；最后在编译应用时将 libpolarssl.a 连接进你的工程中即可。</p>
<h4 id="7-2、当前版本-acl-对-ssl-的支持方式"><a href="#7-2、当前版本-acl-对-ssl-的支持方式" class="headerlink" title="7.2、当前版本 acl 对 ssl 的支持方式"></a>7.2、当前版本 acl 对 ssl 的支持方式</h4><ul>
<li>首先下载解压 polarssl 库后进入polarssl-1.2.19 目录，运行 make lib SHARED&#x3D;yes，在library 目录下会生成 libpolarssl.so 动态库;</li>
<li>在 acl 根目录下运行 make build_one，则会将 acl 的三个基础库：libacl.a, libprotocol.a, libacl_cpp.a 合成 libacl_all.a 一个静态库，将 libacl.so, libprotocol.so, lib_acl_cpp.so 合成 libacl_all.so 一个动态库;</li>
<li>当程序启动时添加代码：acl::polarssl_conf::set_libpath(“libpolarssl.so”); 其中的路径根据实际位置而定，这样 acl 模块在需要 ssl 通信时会自动切换至 ssl 方式。</li>
</ul>
<h3 id="8、Linux-下如何使用-mysql-功能？"><a href="#8、Linux-下如何使用-mysql-功能？" class="headerlink" title="8、Linux 下如何使用 mysql 功能？"></a>8、Linux 下如何使用 mysql 功能？</h3><p>lib_acl_cpp 库是以动态加载方式加载 mysql 动态库的，所以在编译 lib_acl_cpp 时，mysql 功能就已经被编译进去 acl库中了。用户仅需要将 mysql 动态库通过函数 acl::db_handle::set_loadpath 注册进 acl 库中即可；至于 mysql 客户端库，用户可以去 mysql 官方下载或在 acl&#x2F;resource 目录下编译 mysql-connector-c-6.1.6-src.tar.gz。</p>
<h3 id="三、各个功能模块的使用问题"><a href="#三、各个功能模块的使用问题" class="headerlink" title="三、各个功能模块的使用问题"></a>三、各个功能模块的使用问题</h3><h3 id="（一）、网络通信"><a href="#（一）、网络通信" class="headerlink" title="（一）、网络通信"></a>（一）、网络通信</h3><h3 id="（二）、HTTP-模块"><a href="#（二）、HTTP-模块" class="headerlink" title="（二）、HTTP 模块"></a>（二）、HTTP 模块</h3><h4 id="1-acl-HTTP-服务器是否支持断点下载功能？"><a href="#1-acl-HTTP-服务器是否支持断点下载功能？" class="headerlink" title="1. acl HTTP 服务器是否支持断点下载功能？"></a>1. acl HTTP 服务器是否支持断点下载功能？</h4><p>支持。acl HTTP 模块支持断点续传功能，一个支持断点下载的服务器示例参照：acl\app\wizard_demo\httpd_download。</p>
<h4 id="2-acl-HTTP-服务器是否支持文件上传功能？"><a href="#2-acl-HTTP-服务器是否支持文件上传功能？" class="headerlink" title="2. acl HTTP 服务器是否支持文件上传功能？"></a>2. acl HTTP 服务器是否支持文件上传功能？</h4><p>支持。参考示例：acl\app\wizard_demo\httpd_upload。</p>
<h4 id="3-acl-HTTP-模块是否支持服务器-x2F-客户端两种模式？"><a href="#3-acl-HTTP-模块是否支持服务器-x2F-客户端两种模式？" class="headerlink" title="3. acl HTTP 模块是否支持服务器&#x2F;客户端两种模式？"></a>3. acl HTTP 模块是否支持服务器&#x2F;客户端两种模式？</h4><p>支持。目前 acl 的 HTTP 协议模块同时支持客户端及服务端模式，即你既可以使用 acl HTTP 编写客户端程序，又可以编写服务器程序，其中 acl 中的 http_request&#x2F;http_request_pool&#x2F;http_request_manager 类用来编写客户端程序，http_response&#x2F;HttpServlet&#x2F;HttpServletRequest&#x2F;HttpServeletResponse 用来编写服务器程序。</p>
<h4 id="4-acl-HTTP-模块是否支持-websocket-通信协议？"><a href="#4-acl-HTTP-模块是否支持-websocket-通信协议？" class="headerlink" title="4. acl HTTP 模块是否支持 websocket 通信协议？"></a>4. acl HTTP 模块是否支持 websocket 通信协议？</h4><p>支持。可以参考示例：lib_acl_cpp\samples\websocket。</p>
<h4 id="5-acl-HTTP-模块是否支持-session？"><a href="#5-acl-HTTP-模块是否支持-session？" class="headerlink" title="5. acl HTTP 模块是否支持 session？"></a>5. acl HTTP 模块是否支持 session？</h4><p>支持。acl HTTP 模块当用在服务器编程时支持 session 存储，目前支持使用 memcached 或 redis 存储 session 数据。</p>
<h4 id="6-HttpServletRequest-为何读不到-json-或-xml-数据体"><a href="#6-HttpServletRequest-为何读不到-json-或-xml-数据体" class="headerlink" title="6. HttpServletRequest 为何读不到 json 或 xml 数据体"></a>6. HttpServletRequest 为何读不到 json 或 xml 数据体</h4><p>当 HTTP 客户端请求的数据体为 json 或 xml 时，默认情况下从 acl::HttpServletRequest 对象中是读不到 json&#x2F;xml 数据的，主要原因在于 HttpServletRequest 内置了自动读取并解析 json&#x2F;xml&#x2F;x-www-form-urlencoded 类型数据的功能，使用者只需直接获取解析后的对象即可，如针对 json 类数据体：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">get_json</span><span class="hljs-params">(acl::HttpServletRequest&amp; req)</span></span><br><span class="hljs-function"></span>&#123;<br>	acl::json* json = req.<span class="hljs-built_in">getJson</span>();<br>	...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果应用想自己读取并解析 json 数据，则需要在调用 acl::HttpServlet::setParseBody(false)，禁止 acl::HttpServletRequest 类对象内部自动读取数据。</p>
<h4 id="7-http-request-因未设-Host-字段而出错的问题"><a href="#7-http-request-因未设-Host-字段而出错的问题" class="headerlink" title="7. http_request 因未设 Host 字段而出错的问题"></a>7. http_request 因未设 Host 字段而出错的问题</h4><p>在使用 acl::http_request 类对象访问标准 WEB 服务器（如：nginx）时，如果没有设置 HTTP 请求头中的 Host 字段，nginx 会返回 400 错误，主要是 HTTP&#x2F;1.1 协议要求 HTTP 客户端必须设置 Host 字段，方法如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">http_client</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-function">acl::http_request <span class="hljs-title">req</span><span class="hljs-params">(<span class="hljs-string">&quot;www.sina.com.cn:80&quot;</span>)</span></span>;<br>	acl::http_header&amp; hdr = req.<span class="hljs-built_in">request_header</span>();<br>	hdr.<span class="hljs-built_in">set_url</span>(<span class="hljs-string">&quot;/&quot;</span>).<span class="hljs-built_in">set_host</span>(<span class="hljs-string">&quot;www.sina.com.cn&quot;</span>);<br>	<span class="hljs-keyword">if</span> (!req.<span class="hljs-built_in">request</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>)) &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>	&#125;<br>	acl::string body;<br>	<span class="hljs-keyword">if</span> (req.<span class="hljs-built_in">get_body</span>(body)) &#123;<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\r\n&quot;</span>, body.<span class="hljs-built_in">c_str</span>());<br>	&#125;<br>	<br>	... <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="（三）、Redis-模块"><a href="#（三）、Redis-模块" class="headerlink" title="（三）、Redis 模块"></a>（三）、Redis 模块</h3><h4 id="1-acl-redis-库是否支持集群功能？"><a href="#1-acl-redis-库是否支持集群功能？" class="headerlink" title="1. acl redis 库是否支持集群功能？"></a>1. acl redis 库是否支持集群功能？</h4><p>答案：是，acl redis 客户端库同时支持集群和单机方式的 redis-server。</p>
<h4 id="2-acl-redis-库是如何划分的？"><a href="#2-acl-redis-库是如何划分的？" class="headerlink" title="2. acl redis 库是如何划分的？"></a>2. acl redis 库是如何划分的？</h4><p>acl redis 客户端库主要分为两类：命令类和连接类：</p>
<ul>
<li><strong>命令类主要有</strong>：redis_key, redis_string, redis_hash, redis_list, redis_set, redis_zset, redis_cluster, redis_geo, redis_hyperloglog, redis_pubsub, redis_transaction, redis_server, redis_script, 这些类都继承于基类 redis_command，同时子类 redis 又继承了所有这些命令类，以便于用户可以直接使用 acl::redis 操作所有的 redis 客户端命令；</li>
<li><strong>连接类主要有</strong>：redis_client, redis_client_pool, redis_client_cluster，命令类对象通过这些连接类对象与 redis-server 进行交互，redis_client 为单连接类，redis_client_pool 为连接池类，这两个类仅能在非集群模式的 redis-server 环境中使用，不支持 redis-server 的集群模式，必须使用 redis_client_cluster 连接集群模式的 redis-server，同时 redis_client_cluster 也兼容非集群模式的连接。</li>
</ul>
<h4 id="3-acl-redis-库中的哪些类对象操作是线程安全的？"><a href="#3-acl-redis-库中的哪些类对象操作是线程安全的？" class="headerlink" title="3. acl redis 库中的哪些类对象操作是线程安全的？"></a>3. acl redis 库中的哪些类对象操作是线程安全的？</h4><p>acl redis 库中的所有命令类对象及 redis_client 单连接类对象不能同时被多个线程使用（就象 std::string 一样不能跨线程使用）；redis_client_pool，redis_client_cluster 两个连接类对象是线程操作安全的，同一个对象可以被多个线程同时使用。</p>
<h4 id="4-acl-redis-客户库当连接断开时是否会重连？"><a href="#4-acl-redis-客户库当连接断开时是否会重连？" class="headerlink" title="4. acl redis 客户库当连接断开时是否会重连？"></a>4. acl redis 客户库当连接断开时是否会重连？</h4><p>acl redis 库中的连接类中：redis_client，redis_client_pool，redis_client_cluster 三个连接类对象当检测到网络连接异常断开时会尝试自动重连，上层使用者无需考虑连接断开重试的情况。</p>
<h3 id="（四）、协程模块"><a href="#（四）、协程模块" class="headerlink" title="（四）、协程模块"></a>（四）、协程模块</h3><h4 id="1-协程里面的非阻塞是什么原理的？"><a href="#1-协程里面的非阻塞是什么原理的？" class="headerlink" title="1. 协程里面的非阻塞是什么原理的？"></a>1. 协程里面的非阻塞是什么原理的？</h4><p>比如我现在需要访问数据库，这个动作肯定是个阻塞的操作，如果有10个协程进行数据库访问，这个非阻塞是怎么理解的？<br>协程方式在底层将系统的 IO API（read&#x2F;write 等）都 hook 了，数据库操作也要调用这些API，所以表面上的阻塞式DB操作在协程底层的IO也会被转为非阻塞模式。</p>
<h4 id="2-acl-协程库是否支持多线程？"><a href="#2-acl-协程库是否支持多线程？" class="headerlink" title="2. acl 协程库是否支持多线程？"></a>2. acl 协程库是否支持多线程？</h4><p>acl 协程库支持多线程方式，只是支持的方式与 go 语言有所不同。用户可以创建多个线程，每个线程一个协程调度器，线程之间的协程调度是相互隔离的，正如多进程与多线程之间的关系一样（每个进程内可以启动多个线程，但进程之间的线程的调度过程是隔离的），在每个线程内部可以创建大量 acl 协程，每个协程均由其所属的线程内的协程调度器调度运行。</p>
<h4 id="3-acl-协程库如何支持多核-CPU？"><a href="#3-acl-协程库如何支持多核-CPU？" class="headerlink" title="3. acl 协程库如何支持多核 CPU？"></a>3. acl 协程库如何支持多核 CPU？</h4><p>正如 2）所说，用户可以启动多个线程，每个线程一个 acl 协程调度器，每个协程调度器负责调度与其同属相同线程的协程运行状态。</p>
<h4 id="4-acl-协程里针对-mysql-客户端库的协程化是否修改了-mysql-库的源码？"><a href="#4-acl-协程里针对-mysql-客户端库的协程化是否修改了-mysql-库的源码？" class="headerlink" title="4. acl 协程里针对 mysql 客户端库的协程化是否修改了 mysql 库的源码？"></a>4. acl 协程里针对 mysql 客户端库的协程化是否修改了 mysql 库的源码？</h4><p>没有。mysql 客户端库使用的系统 IO API 为 read&#x2F;write&#x2F;poll，而 acl 协程库 HOOK 了系统底层的 IO 过程，因此当将用户程序与 mysql 库及 acl 协程库一起编译后，mysql 库的 IO 过程直接被 acl 协程库 HOOK 的 API 接管，从而将 mysql 客户端库协程化而无须修改一行 mysql 库代码。</p>
<h4 id="5-acl-协程库支持域名解析功能吗？"><a href="#5-acl-协程库支持域名解析功能吗？" class="headerlink" title="5. acl 协程库支持域名解析功能吗？"></a>5. acl 协程库支持域名解析功能吗？</h4><p>支持。很多 C&#x2F;C++ 实现的协程库并未实现 gethostbyname(_r) 函数，导致用户在使用协程编程遇到域名解析时还需要借助单独的线程来完成，acl 库本身从 DNS 协议层次实现了域名解析过程，acl 协程库基于此功能模块 HOOK 了系统的 gethostbyname(_r) API 而无须借助第三方函数库或起单独的线程完成域名解析。</p>
<h4 id="6-acl-协程库的系统-errno-号如何处理？"><a href="#6-acl-协程库的系统-errno-号如何处理？" class="headerlink" title="6. acl 协程库的系统 errno 号如何处理？"></a>6. acl 协程库的系统 errno 号如何处理？</h4><p>acl 协程库实现了协程安全的 errno 号，正如之前使用多线程编程时 errno 可以与每个线程绑定一样，在 acl 协程库里 errno 也是与每个 acl 协程进行绑定的。因此，当你调用 strerror(errno) 时也是协程安全的。</p>
<h4 id="7-如果启动的协程过多，会不会对于后端例如-mysql-之类服务造成并发压力？如何避免？"><a href="#7-如果启动的协程过多，会不会对于后端例如-mysql-之类服务造成并发压力？如何避免？" class="headerlink" title="7. 如果启动的协程过多，会不会对于后端例如 mysql 之类服务造成并发压力？如何避免？"></a>7. 如果启动的协程过多，会不会对于后端例如 mysql 之类服务造成并发压力？如何避免？</h4><p>当启动用协程较多且都需要 mysql 操作时的确会造成 mysql 服务器的并发压力。为避免此并发压力，acl 协程库提供了协程信号量，用来针对后端不支持高并发的服务提供连接保护。</p>
<h3 id="（五）、服务器模块"><a href="#（五）、服务器模块" class="headerlink" title="（五）、服务器模块"></a>（五）、服务器模块</h3><h4 id="1-有几种服务器编程模型？均有何特点？"><a href="#1-有几种服务器编程模型？均有何特点？" class="headerlink" title="1. 有几种服务器编程模型？均有何特点？"></a>1. 有几种服务器编程模型？均有何特点？</h4><p>目前 acl 库中提供：进程池模型、线程池模型、非阻塞模型、协程模型、UDP 通信模型、触发器模型。其中各个编程模型的特点如下：  </p>
<p><strong>进程池模型：</strong> 每个进程处理一个客户端连接，当需要处理多个连接时则需要启动多个进程，此模型的最大缺点是并发度低，优点是编程简单；<br><strong>线程池模型：</strong> 由多个线程组成线程池处理大量的客户端连接，只有当某个连接有数据可读时该连接才会与一个线程绑定，处理完毕则线程归还给线程池，此模型的优点是启动少数线程便处理较大并发，缺点是需要注意线程编程时的线程安全问题；<br><strong>非阻塞模型：</strong> 一个进程内仅有一个工作线程，通过采用非阻塞通信方式可以支持非常大的客户端并发连接，优点是资源消耗小、支持大并发、性能高，缺点是编程复杂度高；<br><strong>协程模型：</strong> 每个客户端连接与一个协程绑定，每个进程内一个工作线程，每个线程内可以创建大 量的协程，优点是支持大并发、性能高、编程简单、应用场景比较广，缺点是占用内存要比非阻塞模型高；<br><strong>UDP通信模型：</strong> 支持简单的 UDP 通信方式；触发器模型：常用在定时任务的应用场景中。<br>以上的服务模型均可启动多个进程，通过配置文件的配置项来决定启动进程的数量。</p>
<h4 id="2-acl-master-的作用是什么？支持哪些平台？"><a href="#2-acl-master-的作用是什么？支持哪些平台？" class="headerlink" title="2. acl_master 的作用是什么？支持哪些平台？"></a>2. acl_master 的作用是什么？支持哪些平台？</h4><p>acl_master 为由以上各个服务器编写的服务进程的控制管理程序， acl_master<br>启动、停止各个服务子进程，控制子进程的启动数量及预启动策略，监控子进程的异常情况；acl_master 有点类似于 LINUX 下的 xinetd 服务进程，不同之处是 acl_master 功能更完善强大，支持服务子进程的常驻留、半驻留，而 xinetd 则只针对一个连接创建一个进程，不能用于高并发的服务应用场景。<br>目前 acl_master 进程仅支持 LINUX&#x2F;MACOS&#x2F;FREEBSD&#x2F;SOLARIS(X86）等 UNIX 平台，不支持 WINDOWS 平台。  </p>
<h4 id="3-没有-acl-master-控制管理，服务子进程是否可以单独运行？"><a href="#3-没有-acl-master-控制管理，服务子进程是否可以单独运行？" class="headerlink" title="3. 没有 acl_master 控制管理，服务子进程是否可以单独运行？"></a>3. 没有 acl_master 控制管理，服务子进程是否可以单独运行？</h4><p>可以。在没有 acl_master 的情况下，由以上各个服务模型编写的服务程序可以通过手工方式启动。启动方式一般为：.&#x2F;xxxx alone xxxx.cf，这样服务程序便以 alone 模式启动运行，具体情况可以参考 main.cpp 里的启动方式；在 WINDOWS 平台下只能是以 alone 模式手工启动运行。</p>
<h4 id="4-手工模式下运行时遇到”idle-timeout-–-exiting-idle”怎么办？"><a href="#4-手工模式下运行时遇到”idle-timeout-–-exiting-idle”怎么办？" class="headerlink" title="4. 手工模式下运行时遇到”idle timeout – exiting, idle”怎么办？"></a>4. 手工模式下运行时遇到”idle timeout – exiting, idle”怎么办？</h4><p>因为 acl 的服务器编程模型均支持半驻留方式（即运行空闲一段时间或处理连接次数达到设定值后会自动退出，这样的好处是：可以定期通过进程退出释放可能存在的资源泄露，另一方面便于用户在开发时通过 valgrind 进行内存检查），如果让进程不退出，可以在 alone 模式下给服务程序传递启动配置文件，如启动方式为：.&#x2F;xxxx alone xxxx.cf（传递方式可以看 main.cpp 和相关头文件），不同的服务器模型分别采取下面不同的配置项：  </p>
<p><strong>程池模型：</strong> 将配置项 single_use_limit 和 single_idle_limit 设为 0；<br><strong>线程池模型：</strong> 将配置项 ioctl_use_limit 和 ioctl_idle_limit 设为 0；<br><strong>非阻塞模型：</strong> 将配置项 aio_use_limit 和 aio_idle_limit 设为 0；<br><strong>协程模型：</strong> 将配置项 fiber_use_limit 和 fiber_idle_limit 设为 0；<br><strong>UDP通信模型：</strong> 将配置项 udp_use_limit 和 udp_idle_limit 设为 0；<br><strong>触发器模型：</strong> 将配置项 trigger_use_limit 设为 0。</p>
<h4 id="5-acl-master-控制模式下，服务子进程如何预启动多个进程？"><a href="#5-acl-master-控制模式下，服务子进程如何预启动多个进程？" class="headerlink" title="5. acl_master 控制模式下，服务子进程如何预启动多个进程？"></a>5. acl_master 控制模式下，服务子进程如何预启动多个进程？</h4><p>需要修改每个服务子进程的配置文件，将配置项：master_maxproc 及 master_prefork 设置成要启动的进程数（设置值需相同），同时需要将 xxx_use_limit 及 xxx_idle_limit 配置项设成 0 以防止子进程空闲退出，xxx_use_limit 及 xxx_idle_limit  的依每种服务器模型而不同，具体可参考上面（4）中的说明。</p>
<h4 id="6-acl-master-控制模式下，如何只监听内网地址？"><a href="#6-acl-master-控制模式下，如何只监听内网地址？" class="headerlink" title="6. acl_master 控制模式下，如何只监听内网地址？"></a>6. acl_master 控制模式下，如何只监听内网地址？</h4><p>在 acl_master 模式下，可以将 master_service 配置项支持模糊匹配方式，即可以将监听地址写成 <code>192.168.*.*:8192</code> 或 <code>10.0.*.*:8192</code> 方式，这样 acl_master 会自动扫描服务器所有的网卡地址，但只监听服务匹配条件的内网地址，这样为统一部署提供方便。</p>
<h3 id="（六）、数据库模块"><a href="#（六）、数据库模块" class="headerlink" title="（六）、数据库模块"></a>（六）、数据库模块</h3><h4 id="1-acl-数据库客户端支持哪些数据库？"><a href="#1-acl-数据库客户端支持哪些数据库？" class="headerlink" title="1. acl 数据库客户端支持哪些数据库？"></a>1. acl 数据库客户端支持哪些数据库？</h4><p>当前 acl 数据库客户端库支持的数据库有：mysql，postgresql，sqlite。</p>
<h4 id="2-acl-数据库模块如何使用？"><a href="#2-acl-数据库模块如何使用？" class="headerlink" title="2. acl 数据库模块如何使用？"></a>2. acl 数据库模块如何使用？</h4><p>acl 数据库模块封装了官方数据库的驱动（包括 mysql，postgresql，sqlite），所以使用者应先下载所对应的官方数据库驱动，考虑到版本的一致性，建议从 <a target="_blank" rel="noopener" href="https://github.com/acl-dev/third_party">https://github.com/acl-dev/third_party</a> 处下载；<br>另外，acl 数据库模块是采用动态加载方式加载数据库驱动的，所以使用者应将编译好的数据库动态库放置在合适的位置，并调用 <code>acl::db_handle::set_loadpath()</code> 设置数据库驱动动态库的全路径，以便于 acl 数据库模块内部可以使用该路径进行动态加载。</p>
<h3 id="（七）、邮件-amp-mime模块"><a href="#（七）、邮件-amp-mime模块" class="headerlink" title="（七）、邮件&amp;mime模块"></a>（七）、邮件&amp;mime模块</h3><p>。。。</p>
<ul>
<li>微博：<a target="_blank" rel="noopener" href="http://weibo.com/zsxxsz">http://weibo.com/zsxxsz</a></li>
<li>qq 群：242722074</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/faq/" class="category-chain-item">faq</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>acl库使用FAQ</div>
      <div>https://acl-dev.cn/2019/06/30/faq/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>zsxxsz</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年6月30日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/01/15/ssl/" title="使用SSL中对数据进行加密传输">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">使用SSL中对数据进行加密传输</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/04/07/fiber/" title="Acl 网络协程框架编程指南">
                        <span class="hidden-mobile">Acl 网络协程框架编程指南</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"zykZv6I4JOYMU6dwI0ehhPRG-gzGzoHsz","appKey":"5Dqdb47Rc6ylIri6ZJGMpt0B","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访问用户数 
        <span id="leancloud-site-uv"></span>
         次
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
